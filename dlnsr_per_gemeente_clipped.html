<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Woonplaats deelnemers gezinsvakanties vzw Gandalf</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/3.0.2/topojson.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #fff;
        }
        #map {
            height: 100vh;
            width: 100%;
        }
        .leaflet-container {
            background: #fff;
        }
        .legend {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            padding: 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            user-select: none;
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 10000;
            min-width: 200px;
        }
        .legend-header {
            background: #2E7D32;
            color: white;
            padding: 10px 15px;
            border-radius: 10px 10px 0 0;
            cursor: move;
            font-weight: bold;
            position: relative;
        }
        .legend-header::after {
            content: "‚ãÆ‚ãÆ";
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            opacity: 0.8;
        }
        .legend-content { padding: 15px; }
        .info-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            z-index: 1000;
            max-width: 300px;
        }
        .toggle-info-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            cursor: pointer;
            z-index: 1001;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <button class="toggle-info-btn info-visible" id="toggleInfoBtn" title="Verberg/Toon info">‚ÑπÔ∏è</button>
    <div class="info-panel" id="infoPanel">
        <h3>üèõÔ∏è Aantal gezinnen per gemeente</h3>
        <p>Klik op de bubbels om de details te zien</p>
        <p>De grootte duidt het aantal deelnemende gezinnen aan</p>
        <p><strong>Total:</strong> <span id="total-count">0</span> gezinnen</p>
    </div>
    <script>
        function initMap() {
            if (typeof L === 'undefined') {
                setTimeout(initMap, 100);
                return;
            }

            const toggleBtn = document.getElementById('toggleInfoBtn');
            const infoPanel = document.getElementById('infoPanel');
            let isInfoVisible = true;
            toggleBtn.addEventListener('click', function() {
                isInfoVisible = !isInfoVisible;
                if (isInfoVisible) {
                    infoPanel.classList.remove('hidden');
                    toggleBtn.classList.add('info-visible');
                    toggleBtn.innerHTML = '‚ÑπÔ∏è';
                } else {
                    infoPanel.classList.add('hidden');
                    toggleBtn.classList.remove('info-visible');
                    toggleBtn.innerHTML = 'üìä';
                }
            });

            const map = L.map('map').setView([51.05, 3.1], 10);

            // No tile layer ‚Üí plain white background

            function getColor(count) {
                if (count >= 30) return '#8B0000';
                if (count >= 20) return '#DC143C';
                if (count >= 15) return '#FF4500';
                if (count >= 10) return '#FF6347';
                if (count >= 5) return '#FFA500';
                return '#FFD700';
            }
            function getRadius(count) { return Math.sqrt(count) * 5 + 5; }

            const municipalityBoundariesUrl = 'https://raw.githubusercontent.com/bmesuere/belgium-topojson/master/source_data/Gemeenten.json';
            fetch(municipalityBoundariesUrl)
                .then(response => response.json())
                .then(data => {
                    const objectKey = Object.keys(data.objects)[0];
                    const geojsonData = topojson.feature(data, data.objects[objectKey]);
                    const filteredFeatures = geojsonData.features.filter(feature => {
                        const props = feature.properties;
                        const municipalityName = (props.NAME_4 || '').toLowerCase().trim();
                        const provinceName = (props.NAME_2 || '').toLowerCase().trim();
                        return provinceName === 'west-vlaanderen' || provinceName === 'west vlaanderen' || municipalityName === 'ronse';
                    });
                    L.geoJSON(filteredFeatures, {
                        style: {
                            color: '#2E7D32',
                            weight: 1.5,
                            fillColor: '#4CAF50',
                            fillOpacity: 0.08,
                            dashArray: '4, 4'
                        }
                    }).addTo(map);
                    addDataBubbles();
                    createDraggableLegend();
                });

            const municipalityData = {
                'Ardooie': { count: 1, lat: 50.976728, lng: 3.199116 },
                'Beernem': { count: 5, lat: 51.1347, lng: 3.3403 },
                'Blankenberge': { count: 15, lat: 51.3133, lng: 3.1317 },
                'Bredene': { count: 1, lat: 51.2489, lng: 2.9614 },
                'Brugge': { count: 40, lat: 51.2093, lng: 3.2247 },
                'De Haan': { count: 1, lat: 51.2833, lng: 3.0333 },
                'De Panne': { count: 2, lat: 51.0978, lng: 2.5931 },
                'Diksmuide': { count: 3, lat: 51.0333, lng: 2.8667 },
                'Ichtegem': { count: 21, lat: 51.0928306, lng: 3.0106116 },
                'Ieper': { count: 11, lat: 50.8503, lng: 2.8847 },
                'Ingelmunster': { count: 5, lat: 50.9167, lng: 3.2667 },
                'Izegem': { count: 9, lat: 50.9139, lng: 3.2167 },
                'Knokke-Heist': { count: 1, lat: 51.3500, lng: 3.2667 },
                'Koekelare': { count: 1, lat: 51.0908, lng: 2.9675 },
                'Koksijde': { count: 1, lat: 51.1200, lng: 2.6367 },
                'Kortemark': { count: 5, lat: 51.0272, lng: 3.0514 },
                'Kortrijk': { count: 1, lat: 50.8281, lng: 3.2648 },
                'Langemark-Poelkapelle': { count: 1, lat: 50.9167, lng: 2.9167 },
                'Ledegem': { count: 1, lat: 50.8642, lng: 3.1311 },
                'Lichtervelde': { count: 1, lat: 51.0311, lng: 3.1422 },
                'Menen': { count: 27, lat: 50.7972, lng: 3.1211 },
                'Moorslede': { count: 3, lat: 50.8833, lng: 3.0667 },
                'Oostende': { count: 16, lat: 51.2289, lng: 2.9181 },
                'Oostkamp': { count: 10, lat: 51.1558, lng: 3.2239 },
                'Poperinge': { count: 3, lat: 50.8547, lng: 2.7344 },
                'Roeselare': { count: 6, lat: 50.9464, lng: 3.1258 },
                'Ronse': { count: 1, lat: 50.7494, lng: 3.6003 },
                'Tielt': { count: 2, lat: 51.0000, lng: 3.3333 },
                'Torhout': { count: 3, lat: 51.0669, lng: 3.1019 },
                'Vleteren': { count: 1, lat: 50.929707, lng: 2.732738 },
                'Wervik': { count: 2, lat: 50.7831, lng: 3.0397 },
                'Wingene': { count: 16, lat: 51.05865, lng: 3.274799 },
                'Zonnebeke': { count: 2, lat: 50.8667, lng: 2.9833 },
                'Zuienkerke': { count: 1, lat: 51.2833, lng: 3.1833 }
            };

            function addDataBubbles() {
                let totalCount = 0;
                Object.entries(municipalityData).forEach(([name, data]) => {
                    totalCount += data.count;
                    const circle = L.circleMarker([data.lat, data.lng], {
                        radius: getRadius(data.count),
                        fillColor: getColor(data.count),
                        color: '#fff',
                        weight: 2,
                        opacity: 0.9,
                        fillOpacity: 0.8
                    });
                    const popupContent = `<div style="text-align:center;min-width:150px;"><h3>${name}</h3><div style="font-size:24px;font-weight:bold;color:${getColor(data.count)};">${data.count}</div><div style="font-size:12px;">gezinnen</div></div>`;
                    circle.bindPopup(popupContent);
                    circle.addTo(map);
                });
                document.getElementById('total-count').textContent = totalCount;
            }

            function createDraggableLegend() {
                const legend = document.createElement('div');
                legend.className = 'legend';
                legend.innerHTML = `
                    <div class="legend-header">Gezinnen per Gemeente</div>
                    <div class="legend-content">
                        <div><span style="color:#8B0000;font-weight:bold;">‚óè</span> 30+ gezinnen</div>
                        <div><span style="color:#DC143C;font-weight:bold;">‚óè</span> 20-29 gezinnen</div>
                        <div><span style="color:#FF4500;font-weight:bold;">‚óè</span> 15-19 gezinnen</div>
                        <div><span style="color:#FF6347;font-weight:bold;">‚óè</span> 10-14 gezinnen</div>
                        <div><span style="color:#FFA500;font-weight:bold;">‚óè</span> 5-9 gezinnen</div>
                        <div><span style="color:#FFD700;font-weight:bold;">‚óè</span> 1-4 gezin(nen)</div>
                    </div>`;
                document.body.appendChild(legend);
            }
        }
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initMap);
        } else {
            initMap();
        }
    </script>
</body>
</html>
